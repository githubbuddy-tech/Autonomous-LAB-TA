<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autonomous Lab TA - Manual Code Checker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            height: fit-content;
        }
        
        .panel h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel h2 i {
            font-size: 1.5rem;
        }
        
        .code-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .code-container {
                grid-template-columns: 1fr;
            }
        }
        
        .code-box {
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .code-header {
            background: #f8f9fa;
            padding: 10px 15px;
            border-bottom: 1px solid #e1e5e9;
            font-weight: 600;
            color: #444;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .code-header .badge {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Consolas', 'Monaco', monospace;
            transition: border-color 0.3s;
            resize: vertical;
            min-height: 200px;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .primary-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
        }
        
        .check-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            flex: 1;
        }
        
        .secondary-btn {
            background: #f0f0f0;
            color: #333;
            border: 2px solid #ddd;
        }
        
        .upload-btn {
            background: linear-gradient(135deg, #2196F3 0%, #0d47a1 100%);
            color: white;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .result-section {
            margin-top: 30px;
        }
        
        .comparison-result {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid #667eea;
        }
        
        .comparison-result.good {
            border-left-color: #4CAF50;
            background: #f1f8e9;
        }
        
        .comparison-result.warning {
            border-left-color: #FF9800;
            background: #fff3e0;
        }
        
        .comparison-result.error {
            border-left-color: #f44336;
            background: #ffebee;
        }
        
        .score-display {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .score-item {
            flex: 1;
            min-width: 120px;
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .score-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .score-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .grade-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }
        
        .grade-a { background: #4CAF50; color: white; }
        .grade-b { background: #8BC34A; color: white; }
        .grade-c { background: #FFC107; color: #333; }
        .grade-d { background: #FF9800; color: white; }
        .grade-f { background: #f44336; color: white; }
        
        .error-list {
            background: #ffebee;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .error-list h4 {
            color: #d32f2f;
            margin-bottom: 10px;
        }
        
        .error-list ul {
            padding-left: 20px;
        }
        
        .error-list li {
            margin-bottom: 8px;
            color: #333;
        }
        
        .suggestions {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .suggestions h4 {
            color: #1976d2;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .suggestions ul {
            padding-left: 20px;
        }
        
        .suggestions li {
            margin-bottom: 8px;
            color: #333;
        }
        
        .output-section {
            margin-top: 20px;
        }
        
        .output-box {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: 'Consolas', 'Monaco', monospace;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .difference-viewer {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .diff-line {
            padding: 5px 10px;
            margin: 2px 0;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            display: flex;
            align-items: center;
        }
        
        .diff-line.added {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 3px solid #4CAF50;
        }
        
        .diff-line.removed {
            background: #ffebee;
            color: #c62828;
            border-left: 3px solid #f44336;
        }
        
        .diff-line.unchanged {
            background: white;
            color: #666;
        }
        
        .line-number {
            min-width: 40px;
            color: #999;
            font-size: 12px;
            margin-right: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }
        
        .loading:after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        .task-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .task-card {
            background: #f8f9fa;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .task-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
        }
        
        .task-card.active {
            border-color: #667eea;
            background: #e3f2fd;
        }
        
        .task-card h4 {
            color: #333;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .task-card .language {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-bottom: 8px;
        }
        
        .task-card .difficulty {
            color: #666;
            font-size: 12px;
            margin-bottom: 5px;
        }
        
        .task-card .description {
            font-size: 11px;
            color: #666;
            margin-top: 5px;
            line-height: 1.3;
        }
        
        .task-card .custom-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #2196F3;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
        }
        
        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .connected {
            background: #4CAF50;
            color: white;
        }
        
        .disconnected {
            background: #f44336;
            color: white;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .notification.success {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #f44336 0%, #c62828 100%);
        }
        
        .notification.info {
            background: linear-gradient(135deg, #2196F3 0%, #0d47a1 100%);
        }
        
        .control-panel {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .language-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .language-selector select {
            padding: 8px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            background: white;
        }
        
        .tab-container {
            margin-top: 20px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #e1e5e9;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .upload-section {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .upload-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            margin-top: 5px;
            transition: border-color 0.3s;
        }
        
        .upload-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .upload-textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Consolas', 'Monaco', monospace;
            min-height: 300px;
            resize: vertical;
            margin-top: 5px;
        }
        
        .upload-textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .manual-item {
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        
        .manual-item:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
        }
        
        .manual-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .manual-title {
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }
        
        .manual-language {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .manual-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .manual-code {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            color: #333;
            margin-bottom: 10px;
            max-height: 100px;
            overflow-y: auto;
        }
        
        .manual-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .manual-btn {
            padding: 5px 12px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .load-btn {
            background: #4CAF50;
            color: white;
        }
        
        .delete-btn {
            background: #f44336;
            color: white;
        }
        
        .manual-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .upload-help {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .upload-help h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .upload-help ul {
            padding-left: 20px;
        }
        
        .upload-help li {
            margin-bottom: 8px;
            color: #333;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-robot"></i> Autonomous Lab TA</h1>
            <p class="subtitle">Intelligent Code Debugging with Manual Solution Upload & Comparison</p>
        </header>
        
        <div class="control-panel">
            <div class="language-selector">
                <label><i class="fas fa-code"></i> Language:</label>
                <select id="languageSelect">
                    <option value="python" selected>Python</option>
                    <option value="javascript">JavaScript</option>
                    <option value="java">Java</option>
                </select>
            </div>
        </div>
        
        <div class="main-content">
            <!-- Left Panel: Code Input -->
            <div class="panel">
                <h2><i class="fas fa-edit"></i> Code Editor</h2>
                
                <div class="form-group">
                    <label><i class="fas fa-tasks"></i> Select Lab Task:</label>
                    <div class="task-selector" id="taskSelector">
                        <!-- Tasks will be loaded here -->
                    </div>
                </div>
                
                <div class="tab-container">
                    <div class="tabs">
                        <div class="tab active" data-tab="student">Student Code</div>
                        <div class="tab" data-tab="manual">Manual Solution</div>
                        <div class="tab" data-tab="upload">Upload Manual</div>
                    </div>
                    
                    <div class="tab-content active" id="student-tab">
                        <div class="code-container">
                            <div class="code-box">
                                <div class="code-header">
                                    <span>Your Code</span>
                                    <span class="badge">Student</span>
                                </div>
                                <textarea id="studentCode" placeholder="Write your solution here...">def sum_list(numbers):
    total = 0
    for i in range(1, len(numbers) + 1):
        total += numbers[i]
    return total

print(sum_list([1, 2, 3]))</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="manual-tab">
                        <div class="code-container">
                            <div class="code-box">
                                <div class="code-header">
                                    <span>Manual Solution</span>
                                    <span class="badge">Reference</span>
                                </div>
                                <textarea id="manualCode" placeholder="Paste the correct manual solution here..."># Correct manual solution for summing a list
def sum_list(numbers):
    """
    Returns the sum of all numbers in the list.
    
    Args:
        numbers: List of integers or floats
        
    Returns:
        Sum of all numbers in the list
    """
    total = 0
    for number in numbers:
        total += number
    return total

# Test cases
if __name__ == "__main__":
    # Test case 1: Basic test
    test1 = [1, 2, 3, 4, 5]
    result1 = sum_list(test1)
    print(f"Test 1: {test1} -> {result1} (Expected: 15)")
    
    # Test case 2: Empty list
    test2 = []
    result2 = sum_list(test2)
    print(f"Test 2: {test2} -> {result2} (Expected: 0)")
    
    # Test case 3: Negative numbers
    test3 = [-1, 2, -3, 4, -5]
    result3 = sum_list(test3)
    print(f"Test 3: {test3} -> {result3} (Expected: -3)")
    
    # Test case 4: Single element
    test4 = [42]
    result4 = sum_list(test4)
    print(f"Test 4: {test4} -> {result4} (Expected: 42)")</textarea>
                            </div>
                        </div>
                        
                        <div class="button-group">
                            <button class="secondary-btn" onclick="loadTaskManual()">
                                <i class="fas fa-download"></i> Load Task Manual
                            </button>
                            <button class="secondary-btn" onclick="toggleManualEdit()" id="editManualBtn">
                                <i class="fas fa-edit"></i> Edit Manual
                            </button>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="upload-tab">
                        <div class="upload-section">
                            <h3 style="margin-bottom: 20px; color: #444;">
                                <i class="fas fa-upload"></i> Upload Manual Solution
                            </h3>
                            
                            <div class="form-group">
                                <label><i class="fas fa-tag"></i> Task ID:</label>
                                <input type="text" id="uploadTaskId" placeholder="e.g., my_custom_task" class="upload-input">
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-heading"></i> Title:</label>
                                <input type="text" id="uploadTitle" placeholder="e.g., Custom Fibonacci Function" class="upload-input">
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-align-left"></i> Description:</label>
                                <input type="text" id="uploadDescription" placeholder="e.g., Function to calculate nth Fibonacci number" class="upload-input">
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-code"></i> Manual Solution Code:</label>
                                <textarea id="uploadCode" class="upload-textarea"># Example: Fibonacci function
def fibonacci(n):
    """
    Returns the nth Fibonacci number.
    
    Args:
        n: Positive integer
        
    Returns:
        nth Fibonacci number
    """
    if n <= 0:
        return 0
    elif n == 1:
        return 1
    else:
        a, b = 0, 1
        for _ in range(2, n + 1):
            a, b = b, a + b
        return b

# Test cases
if __name__ == "__main__":
    test_cases = [0, 1, 5, 10]
    for test in test_cases:
        result = fibonacci(test)
        print(f"fibonacci({test}) = {result}")</textarea>
                            </div>
                            
                            <div class="button-group">
                                <button class="upload-btn" onclick="uploadManual()" id="uploadBtn">
                                    <i class="fas fa-upload"></i> Upload Manual
                                </button>
                                <button class="secondary-btn" onclick="loadUserManuals()">
                                    <i class="fas fa-list"></i> View My Uploads
                                </button>
                                <button class="secondary-btn" onclick="generateTaskId()">
                                    <i class="fas fa-random"></i> Generate ID
                                </button>
                            </div>
                            
                            <div id="uploadResult" style="margin-top: 20px;"></div>
                            
                            <div id="userManualsList" style="margin-top: 30px; display: none;">
                                <h4><i class="fas fa-history"></i> My Uploaded Manuals</h4>
                                <div id="manualsContainer" style="max-height: 300px; overflow-y: auto; margin-top: 10px;">
                                    <!-- Manuals will be loaded here -->
                                </div>
                            </div>
                            
                            <div class="upload-help">
                                <h4><i class="fas fa-info-circle"></i> Upload Instructions:</h4>
                                <ul>
                                    <li><strong>Task ID</strong>: Unique identifier for your manual (letters, numbers, underscores)</li>
                                    <li><strong>Title</strong>: Descriptive title for your manual solution</li>
                                    <li><strong>Description</strong>: Brief explanation of what the code does</li>
                                    <li><strong>Code</strong>: The correct manual solution with test cases</li>
                                    <li>After uploading, you can load and compare student code with your manual</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="check-btn" onclick="checkWithManual()" id="checkBtn">
                        <i class="fas fa-check-circle"></i> Check with Manual
                    </button>
                    <button class="primary-btn" onclick="debugCode()" id="debugBtn">
                        <i class="fas fa-bug"></i> Debug Code
                    </button>
                    <button class="secondary-btn" onclick="runCode()" id="runBtn">
                        <i class="fas fa-play"></i> Run Code
                    </button>
                </div>
            </div>
            
            <!-- Right Panel: Results -->
            <div class="panel">
                <h2><i class="fas fa-chart-line"></i> Comparison Results</h2>
                
                <div id="resultArea">
                    <div class="comparison-result">
                        <h3><i class="fas fa-info-circle"></i> Welcome to Autonomous Lab TA!</h3>
                        <p>This tool helps you compare student code with manual solutions and provides intelligent debugging assistance.</p>
                        
                        <div class="suggestions" style="margin-top: 15px;">
                            <h4><i class="fas fa-lightbulb"></i> Getting Started:</h4>
                            <ul>
                                <li><strong>Step 1</strong>: Select a lab task or upload your own manual solution</li>
                                <li><strong>Step 2</strong>: Write student code in the "Student Code" tab</li>
                                <li><strong>Step 3</strong>: Click "Check with Manual" to compare and get scores</li>
                                <li><strong>Step 4</strong>: Use "Debug Code" for hints or "Run Code" to test execution</li>
                                <li><strong>Step 5</strong>: Upload your own manuals for custom assignments</li>
                            </ul>
                        </div>
                        
                        <div class="upload-help" style="margin-top: 15px;">
                            <h4><i class="fas fa-upload"></i> New: Manual Upload Feature!</h4>
                            <p>You can now upload your own manual solutions:</p>
                            <ol>
                                <li>Go to the <strong>"Upload Manual"</strong> tab</li>
                                <li>Fill in the task details and paste your correct solution</li>
                                <li>Click "Upload Manual" to save it</li>
                                <li>Use "View My Uploads" to manage your manuals</li>
                                <li>Load any manual and compare student code with it</li>
                            </ol>
                        </div>
                    </div>
                </div>
                
                <div class="suggestions" style="margin-top: 20px;">
                    <h4><i class="fas fa-tachometer-alt"></i> Features:</h4>
                    <ul>
                        <li><strong>Manual Comparison</strong>: Compare student code with correct solutions</li>
                        <li><strong>Intelligent Debugging</strong>: Get hints based on error types</li>
                        <li><strong>Code Execution</strong>: Test code in multiple languages</li>
                        <li><strong>Manual Upload</strong>: Create and manage your own reference solutions</li>
                        <li><strong>Detailed Analysis</strong>: Get scores, grades, and improvement suggestions</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="connection-status" id="connectionStatus" style="display: none;">
            <i class="fas fa-sync-alt fa-spin"></i> Connecting...
        </div>
    </div>

    <script>
        // Global variables
        let currentTaskId = null;
        let currentLanguage = 'python';
        let labs = [];
        let isManualEditable = false;
        
        // Language colors
        const languageColors = {
            python: '#306998',
            javascript: '#f7df1e',
            java: '#007396',
            c: '#00599c'
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            setupTabs();
            checkBackendConnection();
        });
        
        // Setup event listeners
        function setupEventListeners() {
            // Language selector
            document.getElementById('languageSelect').addEventListener('change', function() {
                currentLanguage = this.value;
                loadLabs();
                updateCodeExamples();
            });
            
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
        }
        
        // Setup tabs
        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs and contents
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    tab.classList.add('active');
                    
                    // Show corresponding content
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
        }
        
        // Switch tabs
        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(`${tabId}-tab`).classList.add('active');
        }
        
        // Update code examples based on language
        function updateCodeExamples() {
            const examples = {
                python: {
                    student: `def sum_list(numbers):
    total = 0
    for i in range(1, len(numbers) + 1):
        total += numbers[i]
    return total

print(sum_list([1, 2, 3]))`,
                    manual: `# Correct manual solution for summing a list
def sum_list(numbers):
    total = 0
    for number in numbers:
        total += number
    return total

# Test cases
if __name__ == "__main__":
    test_cases = [[1, 2, 3], [], [-1, 2, -3], [42]]
    for test in test_cases:
        result = sum_list(test)
        print(f"sum_list({test}) = {result}")`,
                    upload: `# Example: Fibonacci function
def fibonacci(n):
    """
    Returns the nth Fibonacci number.
    
    Args:
        n: Positive integer
        
    Returns:
        nth Fibonacci number
    """
    if n <= 0:
        return 0
    elif n == 1:
        return 1
    else:
        a, b = 0, 1
        for _ in range(2, n + 1):
            a, b = b, a + b
        return b

# Test cases
if __name__ == "__main__":
    test_cases = [0, 1, 5, 10]
    for test in test_cases:
        result = fibonacci(test)
        print(f"fibonacci({test}) = {result}")`
                },
                javascript: {
                    student: `function sumArray(arr) {
    let total = 0;
    for (let i = 1; i <= arr.length; i++) {
        total += arr[i];
    }
    return total;
}

console.log(sumArray([1, 2, 3]));`,
                    manual: `// Correct manual solution for summing an array
function sumArray(arr) {
    let total = 0;
    for (let i = 0; i < arr.length; i++) {
        total += arr[i];
    }
    return total;
}

// Test cases
const testCases = [
    [1, 2, 3],
    [],
    [-1, 2, -3],
    [42]
];

testCases.forEach(test => {
    console.log(\`sumArray(\${JSON.stringify(test)}) = \${sumArray(test)}\`);
});`,
                    upload: `// Example: Array Sum with Validation
function sumArray(arr) {
    /**
     * Sums all numbers in an array.
     * 
     * @param {number[]} arr - Array of numbers
     * @returns {number} Sum of array elements
     * @throws {Error} If input is not an array
     */
    if (!Array.isArray(arr)) {
        throw new Error('Input must be an array');
    }
    
    let total = 0;
    for (let i = 0; i < arr.length; i++) {
        if (typeof arr[i] !== 'number') {
            throw new Error('Array must contain only numbers');
        }
        total += arr[i];
    }
    return total;
}

// Test cases
try {
    console.log(sumArray([1, 2, 3, 4, 5])); // 15
    console.log(sumArray([])); // 0
    console.log(sumArray([-1, 2, -3])); // -2
} catch (error) {
    console.error('Error:', error.message);
}`
                },
                java: {
                    student: `public class Main {
    public static int sumArray(int[] numbers) {
        int total = 0;
        for (int i = 1; i <= numbers.length; i++) {
            total += numbers[i];
        }
        return total;
    }
    
    public static void main(String[] args) {
        int[] test = {1, 2, 3};
        System.out.println(sumArray(test));
    }
}`,
                    manual: `// Correct manual solution for summing an array
public class Main {
    public static int sumArray(int[] numbers) {
        int total = 0;
        for (int i = 0; i < numbers.length; i++) {
            total += numbers[i];
        }
        return total;
    }
    
    public static void main(String[] args) {
        int[][] testCases = {
            {1, 2, 3},
            {},
            {-1, 2, -3},
            {42}
        };
        
        for (int[] test : testCases) {
            System.out.println("sumArray(" + Arrays.toString(test) + ") = " + sumArray(test));
        }
    }
}`,
                    upload: `// Example: String Reversal
import java.util.Scanner;

public class StringReverser {
    /**
     * Reverses a string using StringBuilder.
     * 
     * @param str String to reverse
     * @return Reversed string
     */
    public static String reverseString(String str) {
        if (str == null) {
            return null;
        }
        return new StringBuilder(str).reverse().toString();
    }
    
    /**
     * Reverses a string using character array.
     * 
     * @param str String to reverse
     * @return Reversed string
     */
    public static String reverseStringManual(String str) {
        if (str == null) {
            return null;
        }
        
        char[] chars = str.toCharArray();
        int left = 0;
        int right = chars.length - 1;
        
        while (left < right) {
            char temp = chars[left];
            chars[left] = chars[right];
            chars[right] = temp;
            left++;
            right--;
        }
        
        return new String(chars);
    }
    
    public static void main(String[] args) {
        String[] testCases = {"hello", "world", "12345", ""};
        
        for (String test : testCases) {
            System.out.println("Original: " + test);
            System.out.println("Reversed (StringBuilder): " + reverseString(test));
            System.out.println("Reversed (Manual): " + reverseStringManual(test));
            System.out.println();
        }
    }
}`
                }
            };
            
            const example = examples[currentLanguage];
            if (example) {
                document.getElementById('studentCode').value = example.student;
                document.getElementById('manualCode').value = example.manual;
                document.getElementById('uploadCode').value = example.upload;
            }
        }
        
        // Check backend connection
        async function checkBackendConnection() {
            const statusElem = document.getElementById('connectionStatus');
            statusElem.style.display = 'block';
            statusElem.className = 'connection-status';
            statusElem.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> Connecting to backend...';
            
            try {
                const response = await fetch('http://localhost:8000/health');
                const data = await response.json();
                
                statusElem.className = 'connection-status connected';
                statusElem.innerHTML = '<i class="fas fa-check-circle"></i> Connected to backend';
                
                await loadLabs();
                
                setTimeout(() => {
                    statusElem.style.display = 'none';
                }, 3000);
                
                return true;
            } catch (error) {
                console.error('Backend connection failed:', error);
                
                statusElem.className = 'connection-status disconnected';
                statusElem.innerHTML = '<i class="fas fa-times-circle"></i> Backend not connected';
                
                document.getElementById('resultArea').innerHTML = `
                    <div class="comparison-result error">
                        <h3><i class="fas fa-exclamation-triangle"></i> Connection Error</h3>
                        <p>Cannot connect to backend server at http://localhost:8000</p>
                        <p>Please make sure the backend is running:</p>
                        <ol>
                            <li>Open terminal in backend folder</li>
                            <li>Run: <code>python main.py</code></li>
                            <li>Wait for server to start</li>
                            <li>Refresh this page</li>
                        </ol>
                    </div>
                `;
                
                return false;
            }
        }
        
        // Load available labs
        async function loadLabs() {
            try {
                const response = await fetch('http://localhost:8000/labs');
                const data = await response.json();
                labs = data.labs;
                
                const taskSelector = document.getElementById('taskSelector');
                taskSelector.innerHTML = '';
                
                labs.forEach(lab => {
                    const langColor = languageColors[lab.language] || '#667eea';
                    const isCustom = lab.is_custom;
                    
                    const taskCard = document.createElement('div');
                    taskCard.className = 'task-card';
                    taskCard.setAttribute('data-task-id', lab.id);
                    taskCard.setAttribute('data-language', lab.language);
                    
                    taskCard.innerHTML = `
                        ${isCustom ? '<div class="custom-badge">MY</div>' : ''}
                        <div class="language" style="background: ${langColor}">${lab.language.toUpperCase()}</div>
                        <h4>${lab.title}</h4>
                        <div class="difficulty">${lab.difficulty.toUpperCase()} ${isCustom ? 'â€¢ UPLOADED' : ''}</div>
                        <div class="description">${lab.description}</div>
                    `;
                    
                    taskCard.onclick = () => selectTask(lab.id);
                    taskSelector.appendChild(taskCard);
                });
                
                // Select first task
                if (labs.length > 0 && !currentTaskId) {
                    selectTask(labs[0].id);
                }
                
            } catch (error) {
                console.error('Error loading labs:', error);
                document.getElementById('taskSelector').innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #666; grid-column: 1 / -1;">
                        <p><i class="fas fa-exclamation-triangle"></i> Could not load lab tasks</p>
                        <p>Make sure backend is running on http://localhost:8000</p>
                    </div>
                `;
            }
        }
        
        // Select a task
        function selectTask(taskId) {
            currentTaskId = taskId;
            
            document.querySelectorAll('.task-card').forEach(card => {
                card.classList.remove('active');
                if (card.getAttribute('data-task-id') === taskId) {
                    card.classList.add('active');
                    
                    // Update language if needed
                    const taskLanguage = card.getAttribute('data-language');
                    if (taskLanguage && taskLanguage !== currentLanguage) {
                        currentLanguage = taskLanguage;
                        document.getElementById('languageSelect').value = currentLanguage;
                    }
                }
            });
            
            loadTaskManual();
        }
        
        // Load task manual solution
        async function loadTaskManual() {
            if (!currentTaskId) {
                showNotification('Please select a task first', 'info');
                return;
            }
            
            try {
                const response = await fetch(`http://localhost:8000/labs/${currentTaskId}`);
                const data = await response.json();
                
                if (data.task.manual_code) {
                    document.getElementById('manualCode').value = data.task.manual_code;
                    showNotification('Manual solution loaded', 'success');
                }
                
                if (data.task.starter_code) {
                    document.getElementById('studentCode').value = data.task.starter_code;
                }
                
                // Switch to manual tab
                switchTab('manual');
                
            } catch (error) {
                console.error('Error loading task:', error);
                showNotification('Failed to load task', 'error');
            }
        }
        
        // Toggle manual edit mode
        function toggleManualEdit() {
            const manualTextarea = document.getElementById('manualCode');
            const editBtn = document.getElementById('editManualBtn');
            
            isManualEditable = !isManualEditable;
            manualTextarea.readOnly = !isManualEditable;
            
            if (isManualEditable) {
                editBtn.innerHTML = '<i class="fas fa-save"></i> Save Manual';
                manualTextarea.focus();
                showNotification('Manual solution is now editable', 'info');
            } else {
                editBtn.innerHTML = '<i class="fas fa-edit"></i> Edit Manual';
                showNotification('Manual solution saved locally', 'success');
            }
        }
        
        // Generate random task ID
        function generateTaskId() {
            const adjectives = ['quick', 'smart', 'fast', 'clever', 'wise', 'bright', 'sharp', 'keen'];
            const nouns = ['solution', 'code', 'program', 'function', 'algorithm', 'script', 'app'];
            const adj = adjectives[Math.floor(Math.random() * adjectives.length)];
            const noun = nouns[Math.floor(Math.random() * nouns.length)];
            const randomNum = Math.floor(Math.random() * 1000);
            const taskId = `${adj}_${noun}_${randomNum}`;
            
            document.getElementById('uploadTaskId').value = taskId;
            showNotification(`Generated ID: ${taskId}`, 'info');
        }
        
        // Upload manual solution
        async function uploadManual() {
            const taskId = document.getElementById('uploadTaskId').value.trim();
            const title = document.getElementById('uploadTitle').value.trim();
            const description = document.getElementById('uploadDescription').value.trim();
            const code = document.getElementById('uploadCode').value.trim();
            const uploadBtn = document.getElementById('uploadBtn');
            
            if (!taskId) {
                showNotification('Please enter a Task ID', 'error');
                return;
            }
            
            if (!code) {
                showNotification('Please enter manual solution code', 'error');
                return;
            }
            
            uploadBtn.disabled = true;
            uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
            
            try {
                const response = await fetch('http://localhost:8000/upload-manual', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        task_id: taskId,
                        language: currentLanguage,
                        manual_code: code,
                        title: title || undefined,
                        description: description || undefined
                    })
                });
                
                const result = await response.json();
                
                document.getElementById('uploadResult').innerHTML = `
                    <div class="comparison-result good">
                        <h4><i class="fas fa-check-circle"></i> Upload Successful!</h4>
                        <p><strong>Task ID:</strong> ${result.task_id}</p>
                        <p><strong>Title:</strong> ${result.title || 'Untitled'}</p>
                        <p><strong>Language:</strong> ${result.language}</p>
                        <p><strong>Code Length:</strong> ${result.code_length} characters</p>
                        <p><strong>Preview:</strong> ${result.code_preview}</p>
                        <p>${result.message}</p>
                        <div class="manual-actions" style="margin-top: 10px;">
                            <button class="manual-btn load-btn" onclick="loadUploadedManual('${result.task_id}')">
                                <i class="fas fa-download"></i> Load This Manual
                            </button>
                            <button class="manual-btn" onclick="selectTask('${result.task_id}')" style="background: #667eea; color: white;">
                                <i class="fas fa-tasks"></i> Select as Current Task
                            </button>
                        </div>
                    </div>
                `;
                
                showNotification('Manual uploaded successfully', 'success');
                
                // Clear form
                document.getElementById('uploadTitle').value = '';
                document.getElementById('uploadDescription').value = '';
                document.getElementById('uploadCode').value = '';
                
                // Refresh labs list
                loadLabs();
                
                // Refresh manuals list
                loadUserManuals();
                
            } catch (error) {
                console.error('Upload error:', error);
                document.getElementById('uploadResult').innerHTML = `
                    <div class="comparison-result error">
                        <h4><i class="fas fa-exclamation-circle"></i> Upload Failed</h4>
                        <p>Error: ${error.message}</p>
                        <p>Please check your connection and try again.</p>
                    </div>
                `;
                showNotification('Upload failed: ' + error.message, 'error');
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = '<i class="fas fa-upload"></i> Upload Manual';
            }
        }
        
        // Load user manuals
        async function loadUserManuals() {
            const manualsList = document.getElementById('userManualsList');
            const container = document.getElementById('manualsContainer');
            
            manualsList.style.display = 'block';
            container.innerHTML = '<div class="loading">Loading your manuals...</div>';
            
            try {
                const response = await fetch('http://localhost:8000/user-manuals');
                const data = await response.json();
                
                if (data.manuals.length === 0) {
                    container.innerHTML = `
                        <div class="comparison-result" style="padding: 20px; text-align: center;">
                            <p><i class="fas fa-inbox"></i> No manuals uploaded yet</p>
                            <p>Upload your first manual solution using the form above!</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                data.manuals.forEach(manual => {
                    const langColor = languageColors[manual.language] || '#667eea';
                    
                    html += `
                        <div class="manual-item">
                            <div class="manual-header">
                                <div class="manual-title">${escapeHtml(manual.title)}</div>
                                <div class="manual-language" style="background: ${langColor}">${manual.language.toUpperCase()}</div>
                            </div>
                            <div class="manual-description">${escapeHtml(manual.description)}</div>
                            <div class="manual-code">${escapeHtml(manual.code_preview)}</div>
                            <div class="manual-actions">
                                <button class="manual-btn load-btn" onclick="loadUploadedManual('${manual.id}')">
                                    <i class="fas fa-download"></i> Load
                                </button>
                                <button class="manual-btn delete-btn" onclick="deleteManual('${manual.id}', '${manual.title}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('Error loading manuals:', error);
                container.innerHTML = `
                    <div class="comparison-result error">
                        <p><i class="fas fa-exclamation-triangle"></i> Failed to load manuals</p>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Load a specific uploaded manual
        async function loadUploadedManual(taskId) {
            try {
                const response = await fetch(`http://localhost:8000/labs/${taskId}`);
                const data = await response.json();
                
                if (data.task.manual_code) {
                    document.getElementById('manualCode').value = data.task.manual_code;
                    currentTaskId = taskId;
                    
                    // Update task selector
                    document.querySelectorAll('.task-card').forEach(card => {
                        card.classList.remove('active');
                    });
                    
                    // Switch to manual tab
                    switchTab('manual');
                    
                    showNotification(`Loaded manual: ${data.task.title}`, 'success');
                }
                
            } catch (error) {
                console.error('Error loading manual:', error);
                showNotification('Failed to load manual', 'error');
            }
        }
        
        // Delete a manual
        async function deleteManual(taskId, taskTitle) {
            if (!confirm(`Are you sure you want to delete "${taskTitle}"?\nThis action cannot be undone.`)) {
                return;
            }
            
            try {
                const response = await fetch(`http://localhost:8000/manual/${taskId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                showNotification(`Deleted: ${taskTitle}`, 'success');
                
                // Refresh the lists
                loadLabs();
                loadUserManuals();
                
            } catch (error) {
                console.error('Delete error:', error);
                showNotification('Failed to delete manual: ' + error.message, 'error');
            }
        }
        
        // Check student code with manual solution
        async function checkWithManual() {
            const studentCode = document.getElementById('studentCode').value.trim();
            const manualCode = document.getElementById('manualCode').value.trim();
            const checkBtn = document.getElementById('checkBtn');
            
            if (!studentCode) {
                showNotification('Please enter student code', 'error');
                return;
            }
            
            if (!manualCode) {
                showNotification('Please enter or load manual solution', 'error');
                return;
            }
            
            if (!currentTaskId) {
                showNotification('Please select a task first', 'error');
                return;
            }
            
            checkBtn.disabled = true;
            checkBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Checking...';
            
            document.getElementById('resultArea').innerHTML = `
                <div class="loading">
                    <div style="text-align: center; padding: 40px;">
                        <div style="margin-bottom: 10px; font-size: 1.2rem;">ðŸ” Comparing with manual solution...</div>
                        <div style="font-size: 14px; color: #666;">Analyzing syntax, logic, and outputs</div>
                    </div>
                </div>
            `;
            
            try {
                const response = await fetch('http://localhost:8000/manual-check', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        student_code: studentCode,
                        manual_code: manualCode,
                        language: currentLanguage,
                        task_id: currentTaskId
                    })
                });
                
                const result = await response.json();
                
                if (result.error) {
                    throw new Error(result.error);
                }
                
                displayComparisonResult(result);
                showNotification('Manual check completed', 'success');
                
            } catch (error) {
                console.error('Manual check error:', error);
                document.getElementById('resultArea').innerHTML = `
                    <div class="comparison-result error">
                        <h3><i class="fas fa-exclamation-triangle"></i> Check Failed</h3>
                        <p>Error: ${error.message}</p>
                        <p>Please check your code and try again.</p>
                    </div>
                `;
                showNotification('Check failed: ' + error.message, 'error');
            } finally {
                checkBtn.disabled = false;
                checkBtn.innerHTML = '<i class="fas fa-check-circle"></i> Check with Manual';
            }
        }
        
        // Display comparison results
        function displayComparisonResult(result) {
            let html = '';
            
            // Overall grade and score
            const gradeClass = `grade-${result.grade.toLowerCase()}`;
            
            html += `
                <div class="comparison-result ${result.overall_score >= 0.7 ? 'good' : result.overall_score >= 0.5 ? 'warning' : 'error'}">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3><i class="fas fa-chart-bar"></i> Manual Check Results</h3>
                        <div class="grade-badge ${gradeClass}">Grade: ${result.grade}</div>
                    </div>
                    
                    <div class="score-display">
                        <div class="score-item">
                            <div class="score-value">${Math.round(result.overall_score * 100)}%</div>
                            <div class="score-label">Overall Score</div>
                        </div>
                        <div class="score-item">
                            <div class="score-value">${Math.round(result.syntax_match * 100)}%</div>
                            <div class="score-label">Syntax Match</div>
                        </div>
                        <div class="score-item">
                            <div class="score-value">${Math.round(result.logic_match * 100)}%</div>
                            <div class="score-label">Logic Match</div>
                        </div>
                        <div class="score-item">
                            <div class="score-value">${Math.round(result.output_match * 100)}%</div>
                            <div class="score-label">Output Match</div>
                        </div>
                    </div>
            `;
            
            // Errors found
            if (result.errors && result.errors.length > 0) {
                html += `
                    <div class="error-list">
                        <h4><i class="fas fa-exclamation-circle"></i> Issues Found (${result.errors.length})</h4>
                        <ul>
                            ${result.errors.map(error => `<li>${escapeHtml(error)}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            // Suggestions
            if (result.suggestions && result.suggestions.length > 0) {
                html += `
                    <div class="suggestions">
                        <h4><i class="fas fa-lightbulb"></i> Improvement Suggestions</h4>
                        <ul>
                            ${result.suggestions.map(suggestion => `<li>${escapeHtml(suggestion)}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            // Code differences
            if (result.code_differences && result.code_differences.length > 0) {
                html += `
                    <div class="difference-viewer">
                        <h4 style="margin-bottom: 10px;"><i class="fas fa-code"></i> Code Differences</h4>
                        <div style="max-height: 200px; overflow-y: auto;">
                `;
                
                result.code_differences.forEach(diff => {
                    let diffClass = 'unchanged';
                    if (diff.type === 'added') diffClass = 'added';
                    if (diff.type === 'removed') diffClass = 'removed';
                    
                    html += `
                        <div class="diff-line ${diffClass}">
                            <span class="line-number">${diff.line}</span>
                            <span>${escapeHtml(diff.student || diff.manual)}</span>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            // Output comparison
            html += `
                <div class="output-section">
                    <h4><i class="fas fa-terminal"></i> Output Comparison</h4>
            `;
            
            if (result.student_execution && result.student_execution.output) {
                html += `
                    <p><strong>Student Output:</strong></p>
                    <div class="output-box">${escapeHtml(result.student_execution.output)}</div>
                `;
            }
            
            if (result.manual_execution && result.manual_execution.output) {
                html += `
                    <p style="margin-top: 10px;"><strong>Manual Output:</strong></p>
                    <div class="output-box">${escapeHtml(result.manual_execution.output)}</div>
                `;
            }
            
            html += `
                </div>
            </div>
            `;
            
            document.getElementById('resultArea').innerHTML = html;
        }
        
        // Debug code
        async function debugCode() {
            const studentCode = document.getElementById('studentCode').value.trim();
            const debugBtn = document.getElementById('debugBtn');
            
            if (!studentCode) {
                showNotification('Please enter code to debug', 'error');
                return;
            }
            
            if (!currentTaskId) {
                showNotification('Please select a task first', 'error');
                return;
            }
            
            debugBtn.disabled = true;
            debugBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Debugging...';
            
            try {
                const studentId = 'student_' + Math.random().toString(36).substr(2, 9);
                
                const response = await fetch('http://localhost:8000/debug', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        code: studentCode,
                        language: currentLanguage,
                        task_id: currentTaskId,
                        student_id: studentId,
                        hint_level: 2
                    })
                });
                
                const result = await response.json();
                
                let html = `
                    <div class="comparison-result ${result.success ? 'good' : 'error'}">
                        <h3><i class="fas fa-bug"></i> Debug Results</h3>
                `;
                
                if (result.error_type) {
                    html += `<div class="grade-badge ${result.success ? 'grade-a' : 'grade-f'}" style="margin-bottom: 15px;">${result.error_type}</div>`;
                }
                
                if (result.hint) {
                    html += `
                        <div class="suggestions">
                            <h4><i class="fas fa-comment-dots"></i> Hint</h4>
                            <p>${escapeHtml(result.hint).replace(/\n/g, '<br>')}</p>
                        </div>
                    `;
                }
                
                if (result.issues && result.issues.length > 0) {
                    html += `
                        <div class="error-list">
                            <h4><i class="fas fa-exclamation-circle"></i> Issues Found</h4>
                            <ul>
                                ${result.issues.map(issue => `<li>${escapeHtml(issue)}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                if (result.suggestions && result.suggestions.length > 0) {
                    html += `
                        <div class="suggestions">
                            <h4><i class="fas fa-lightbulb"></i> Suggestions</h4>
                            <ul>
                                ${result.suggestions.map(suggestion => `<li>${escapeHtml(suggestion)}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                if (result.output) {
                    html += `
                        <div class="output-section">
                            <h4><i class="fas fa-terminal"></i> Output</h4>
                            <div class="output-box">${escapeHtml(result.output)}</div>
                        </div>
                    `;
                }
                
                html += `</div>`;
                
                document.getElementById('resultArea').innerHTML = html;
                showNotification('Debugging completed', 'success');
                
            } catch (error) {
                console.error('Debug error:', error);
                showNotification('Debug failed: ' + error.message, 'error');
            } finally {
                debugBtn.disabled = false;
                debugBtn.innerHTML = '<i class="fas fa-bug"></i> Debug Code';
            }
        }
        
        // Run code
        async function runCode() {
            const studentCode = document.getElementById('studentCode').value.trim();
            const runBtn = document.getElementById('runBtn');
            
            if (!studentCode) {
                showNotification('Please enter code to run', 'error');
                return;
            }
            
            runBtn.disabled = true;
            runBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Running...';
            
            try {
                const response = await fetch('http://localhost:8000/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        code: studentCode,
                        language: currentLanguage
                    })
                });
                
                const result = await response.json();
                
                let html = `
                    <div class="comparison-result ${result.success ? 'good' : 'error'}">
                        <h3><i class="fas fa-play-circle"></i> Execution Results</h3>
                        <div class="grade-badge ${result.success ? 'grade-a' : 'grade-f'}" style="margin-bottom: 15px;">
                            ${result.success ? 'SUCCESS' : 'FAILED'}
                        </div>
                `;
                
                if (result.output) {
                    html += `
                        <div class="output-section">
                            <h4><i class="fas fa-terminal"></i> Output</h4>
                            <div class="output-box">${escapeHtml(result.output)}</div>
                        </div>
                    `;
                }
                
                if (result.error) {
                    html += `
                        <div class="error-list">
                            <h4><i class="fas fa-exclamation-triangle"></i> Error</h4>
                            <div class="output-box">${escapeHtml(result.error)}</div>
                        </div>
                    `;
                }
                
                html += `</div>`;
                
                document.getElementById('resultArea').innerHTML = html;
                showNotification('Code execution completed', result.success ? 'success' : 'error');
                
            } catch (error) {
                console.error('Run error:', error);
                showNotification('Execution failed: ' + error.message, 'error');
            } finally {
                runBtn.disabled = false;
                runBtn.innerHTML = '<i class="fas fa-play"></i> Run Code';
            }
        }
        
        // Helper functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function showNotification(message, type = 'info') {
            // Remove existing notifications
            document.querySelectorAll('.notification').forEach(n => n.remove());
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                info: 'fa-info-circle'
            };
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `<i class="fas ${icons[type]}"></i> ${message}`;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>